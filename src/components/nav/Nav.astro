---
import { Logo } from "@/icons/Logo";
import Hamburger from "./Hamburger.tsx";
import { GithubProfile, LinkedInProfile } from "../utils/utils";

export interface NavLink {
  href: string;
  label: string;
}

export interface SocialIcon {
  href: string;
  src: string;
  alt: string;
  className?: string;
}

export interface Props {
  navLinks?: NavLink[];
  socialIcons?: SocialIcon[];
}

const {
  navLinks = [
    { href: "/#backend-+-system-design", label: "Backend" },
    { href: "/#frontend-+-ui-ux", label: "Frontend" },
    { href: "/#contact-+-cv", label: "Contact + CV" },
  ],
  socialIcons = [
    {
      href: GithubProfile,
      src: "/github.svg",
      alt: "GitHub Icon",
    },
    {
      href: LinkedInProfile,
      src: "/linkedin.svg",
      alt: "LinkedIn Icon",
    },
  ],
} = Astro.props;
---

<section
  id="nav"
  class="fixed transition-all top-0 w-full h-20 backdrop-blur flex gap-4 justify-between px-4 md:px-6 items-center z-50 bg-primary-200/[0.4]"
>
  <a href="/" class="flex gap-2 items-center">
    <div id="nav-logo" class="transition-all duration-500 overflow-hidden">
      <h2 class="text-[2rem] sm:text-[3rem] mt-2 block leading-none transition-all">Mateusz</h2>
    </div>
    <Logo className="w-8 sm:w-12 mx-auto" />
  </a>
  <div class="hidden md:flex items-center gap-4">
    {
      navLinks.map(link => (
        <a href={link.href} class={`text-lg hover:underline`}>
          {link.label}
        </a>
      ))
    }
    <div class="flex items-center gap-2">
      {
        socialIcons.map(icon => (
          <a href={icon.href} target="_blank" rel="noopener noreferrer" class={icon.className || ""}>
            <img src={icon.src} alt={icon.alt} class="w-7 h-7" />
          </a>
        ))
      }
    </div>
  </div>
  <div class="flex md:hidden items-center">
    <Hamburger id="mobile-navbar-toggle" />
  </div>
</section>

<section id="mobile-navbar">
  {
    navLinks.map(link => (
      <a href={link.href} class={`text-2xl hover:underline`}>
        {link.label}
      </a>
    ))
  }
  <div class="flex items-center gap-8">
    {
      socialIcons.map(icon => (
        <a href={icon.href} target="_blank" rel="noopener noreferrer" class={icon.className || ""}>
          <img src={icon.src} alt={icon.alt} class="w-6 h-6" />
        </a>
      ))
    }
  </div>
</section>

<style lang="postcss">
    @import "~/global.css" reference;

    :global(#nav-logo.open) {
        @apply w-[130px] sm:w-[200px];
    }

    :global(#nav-logo:not(.open)) {
        @apply w-0 opacity-0;
    }

    :global(#mobile-navbar) {
        transform: translateX(-100vw);
        transition: 0.4s transform;
        @apply h-screen w-full bg-primary-200/[0.6] backdrop-blur fixed left-0 top-0 pt-20 z-40 flex flex-col items-center justify-center gap-6;
    }

    :global(#mobile-navbar.open) {
        transform: translateX(0vw);
    }
</style>

<script>
  const nav = document.getElementById("nav")!;
  const logo = document.getElementById("nav-logo")!;

  let oldScroll = 0;

  function scroll() {
    if (window.scrollY < oldScroll || window.scrollY < 80) {
      nav.style.transform = `translateY(0px)`;
      logo.classList.add("open");
    } else {
      logo.classList.remove("open");
      nav.style.transform = `translateY(-100px)`;
    }
    oldScroll = window.scrollY;
  }

  oldScroll = window.scrollY;
  scroll();
  window.addEventListener("scroll", () => scroll());

  const mobileNavbar = document.getElementById("mobile-navbar")!;
  const mobileNavbarToggle = document.getElementById("mobile-navbar-toggle")!;
  const links = document.querySelectorAll("#mobile-navbar a");

  mobileNavbarToggle.addEventListener("click", () => {
    mobileNavbar.classList.toggle("open");
    mobileNavbarToggle.classList.toggle("is-active");
    links.forEach(link => {
      link.addEventListener("click", () => {
        mobileNavbar.classList.remove("open");
        mobileNavbarToggle.classList.remove("is-active");
      });
    });
  });
</script>
